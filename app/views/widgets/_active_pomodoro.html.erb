<% unless @pomodoro.nil? %>
	<aside>
	
		<section id="activePomodoro" class="contentBoxNav">
			<nav>
				<ul>
					<li class="active"><a class="tabs">Active pomodoro</a></li>
				</ul>
			</nav>
			<div class="widgetBox timer">
			
				<span class="time" data-seconds="<%= (Pomodoro.length * 60) - ((Time.now - @pomodoro.created_at)).to_i %>"><%= Pomodoro.length - ((Time.now - @pomodoro.created_at) / 60).to_i %></span>
				<%= @pomodoro.activity.name %>
				
				<% unless @pomodoro.activity.description.blank? %>
					<div class="activity_details">
						<%= @pomodoro.activity.description %>
					</div>
					<%= link_to("Details", activity_path(@pomodoro.activity), :class => :button) %>
				<% end %>
				
				<div class="pomodorosCount">
					<%= pomodoros_completed_ratio(@pomodoro.activity.pomodoros.successful_and_completed.count, @pomodoro.activity.estimated_pomodoros) %>
				</div>
				
				<%= form_for(@pomodoro, :url => pomodoro_path(@pomodoro)) do |f| %>
					<%= hidden_field_tag("pomodoro[completed]", true) %>
					<div class="field">
						<%= f.text_area :comments %>
					</div>
					<% if Time.now - @pomodoro.created_at < Pomodoro.length.minutes %>
						<%= hidden_field_tag("pomodoro[successful]", false) %>
						<div class="field">
							<%= f.submit("Void", :class => :submit, :confirm => "Are you sure? You will lose all progress!") %>
						</div>
					<% else %>
						<div class="field">
							<%= f.label :successful %>
							<%= f.check_box :successful, :checked => true, :class => :tickbox %>
						</div>
						<div class="field">
							<%= f.submit("Complete", :class => :submit) %>
						</div>
					<% end %>
					<%= link_to("Edit activity", edit_activity_path(@pomodoro.activity), :class => :button) %>
				<% end %>
			</div>
		</section>

	</aside>
<% end %>

<%= render "widgets/timed_break" %>