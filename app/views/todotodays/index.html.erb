<h1>Todo today</h1>

<% unless @pomodoro.nil? %>
	<div class="active_pomodoro">
		<h3><%= @pomodoro.activity.name %></h3>
		
		<div class="timer">
			Started <%= ((Time.now - @pomodoro.created_at) / 60).to_i %> minutes ago
		</div>
		
		<p><%= @pomodoro.activity.description %></p>
		
		<%= form_for(@pomodoro, :url => pomodoro_path(@pomodoro)) do |f| %>
			<%= hidden_field_tag("pomodoro[completed]", true) %>
			<div class="field">
				<%= f.text_area :comments %>
			</div>
			<% if Time.now - @pomodoro.created_at < 30.minutes %>
				<%= hidden_field_tag("pomodoro[successful]", false) %>
				<div class="field">
					<%= f.submit("Void") %>
				</div>
			<% else %>
				<div class="field">
					<%= f.label :successful %>
					<%= f.check_box :successful, :checked => true %>
				</div>
				<div class="field">
					<%= f.submit("Complete") %>
				</div>
			<% end %>
		<% end %>
	</div>
<% end %>

<% unless @todotodays.empty? %>
	<table>
		<tr>
			<th>Completed</th>
			<th>Activity name</th>
			<th>Pomodoros</th>
			<th>Deadline</th>
			<th>Project</th>
			<th>Actions</th>
		</tr>
		<% @todotodays.each do |td| %>
		<% a = td.activity %>
		<tr>
			<td><%= check_box_tag( "activity_completed_" + a.id.to_s, a.completed, a.completed, :disabled => true ) %></td>
			<td><%= a.name %></td>
			<td><%= a.estimated_pomodoros %></td>
			<td><%= due_at_status(a.deadline) %></td>
			<td>-</td>
			<td>
				<%= link_to("Do it now", pomodoros_path(:activity_id => a), :method => :post) %> | 
				<%= link_to("Do it another day", td, :confirm => "Are you sure?", :method => :delete) %>
			</td>
		</tr>
		<% end %>
	</table>
	
	<%= will_paginate @activities %>
<% end %>